(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();function c(t,e){const n={};return n.vnode=!0,n.type=t,n.props=e||{},n.children=[].concat.apply([],[].slice.call(arguments,2)),n.isInstance=t&&t.template&&typeof t.template=="function",n.isComponent=typeof t=="function"&&t.prototype&&typeof t.prototype.render=="function",n.isStateless=typeof t=="function"&&!n.isComponent,n.isDom=typeof t=="string",n}c.f=t=>t.children;function ce(t,e){for(const n in e)t[n]=e[n];return t}function L(){}function qe(t,e,n,s){if(s)return{log:L,warn:L,error:L};const r=[];t=t.toUpperCase(),r.push(`%c ${t} `);let i="font-weight:bold;";return e&&(i+=`color:${e};`),n&&(i+=`background-color:${n}`),r.push(i),{log:console.log.bind(console,...r),warn:console.warn.bind(console,...r),error:console.error.bind(console,...r)}}const Ce=["nodes","components","refs","domEvents","storeEvents"];class I{constructor(){this.data={};for(let e=0;e<Ce.length;e++)this.data[Ce[e]]=[]}append(e){for(const n in e)this.data[n]=this.data[n].concat(e[n])}set(e){for(const n in e)this.data[n]=e[n]}get(){return this.data}}const z=["xlink","xmlns","xml"],Ze=new Set(["placeholder","autoplay","muted","for","webkit-playsinline","playsinline","selected"]);let te;const T=(t,e)=>t.substr(0,e.length)===e,ze=t=>(e,n)=>n.classList.toggle(t,e||!1),ne=(t="textContent",e)=>(n,s)=>{e&&t!==(t=t.replace(/^xlink:?/,""))?s.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):(te=n??"",e||(s[t]=te),(e||Ze.has(t)||T(t,"data-"))&&s.setAttribute(t,te))};function Je(t,e,n,s,r){if(n!==void 0&&!(e==="__self"||e==="__source")){e==="className"&&(e="class");for(let i=0;i<z.length;i++)if(T(e,z[i])){const o=z[i].length;e[o]&&e[o]!==":"&&(e=z[i]+":"+e[o].toLowerCase()+e.substr(o+1,e.length));break}if(e!=="ref"){if(T(e,"event-")){const i=e.toLowerCase().substring(6);s.append({domEvents:[{el:t,evt:i,fn:n}]})}else if(e==="store"){const i=Array.isArray(n)?n:[n],o=[];for(let a=0,f=i.length;a<f;a++){const u=Array.isArray(i[a])?i[a]:[i[a]],d=u[0],w=u[1],m=u[2]!==void 0?u[2]:!0;d&&o.push({store:d,fn:w,init:m,el:t})}s.append({storeEvents:o})}else if(T(e,"store-class-")){const i=e.substring(12),o=ze(i);s.append({storeEvents:[{store:n,init:!0,fn:o,el:t}]})}else if(T(e,"store-")){let i=e.substring(6);i==="text"&&(i="textContent");const o=ne(i,r);s.append({storeEvents:[{store:n,init:!0,fn:o,el:t}]})}else if(!(typeof n=="function"&&T(e,"on")))if(e==="class"&&!r)t.className=n||"";else if(e==="style")typeof n=="object"?ce(t.style,n):typeof n=="string"&&(t.style.cssText=n);else if(e!=="list"&&e!=="type"&&!r&&e in t)try{ne(e,r)(n,t)}catch{}else typeof n!="object"&&typeof n!="function"&&ne(e,r)(n,t)}}}function Ye(t){return Array.isArray(t)?t:[t]}function Z(t,e){if(Array.isArray(t))return Ge(t,e);if(t instanceof window.Element)return et(t);if(t===null||typeof t!="object"||!t.vnode)return Xe(t);const n=ce(ce({},t.props),{children:[].concat.apply([],t.children||[])});if(t.isDom)return Qe(t,n,e);if(t.isInstance)return ke(t,n,e,!0);if(t.isStateless)return tt(t,n,e);if(t.isComponent)return ke(t,n,e)}function Ge(t,e){t=Ye(t);const n=new I;for(let s=0;s<t.length;s++)n.append(Z(t[s],e));return n.get()}function Xe(t){const e=new I;return t==null||t===!1||e.append({nodes:document.createTextNode(t+"")}),e.get()}function Qe(t,e,n){const s=new I;let r=[];t.type==="svg"&&(n=!0);for(let o=0;o<e.children.length;o++){const a=Z(e.children[o],n);a.nodes&&(r=r.concat(a.nodes),s.append({components:a.components,refs:a.refs,domEvents:a.domEvents,storeEvents:a.storeEvents}))}const i=n?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type);for(const o in t.props)Je(i,o,t.props[o],s,n);for(let o=0;o<r.length;o++)i.appendChild(r[o]);return e.ref&&s.append({refs:{ref:i,fn:e.ref}}),s.append({nodes:i}),s.get()}function et(t){const e=new I;return e.append({nodes:t}),e.get()}function tt(t,e,n){const s=new I,r=t.type(e);return s.append(Z(r,n)),s.get()}function ke(t,e,n,s=!1){const r=new I,i=s?t.type:new t.type(e);s&&(e=i.props),i.beforeRender(e);const o=i.template(e,i.state||{});e.ref&&r.append({refs:{ref:i,fn:e.ref}}),r.append(Z(o,n));const a=r.data.nodes;i.base=a.length>1?a:a[0];for(const f in r.data)f!=="nodes"&&(i._collector[f]||(i._collector[f]=[]),i._collector[f]=i._collector[f].concat(r.data[f]));r.set({components:[i],refs:[],domEvents:[],storeEvents:[]});for(let f=0;f<i._collector.components.length;f++)i._collector.components[f]._parent=i;return r.get()}function B(t,e,n){const s=t._collector&&t._collector.components;if(n&&e(t),s)for(let r=0;r<s.length;r++)B(s[r],e);n||e(t)}function nt(t){for(let e=0;e<t._collector.refs.length;e++)t._collector.refs[e].fn(t._collector.refs[e].ref),t._collector.refs[e].ref=null}function st(t){for(let e=0;e<t._collector.storeEvents.length;e++){const n=t._collector.storeEvents[e],s=n.fn;n.fn=function(r){s(r,n.el)},n.store.subscribe(n.fn),n.init&&n.fn(n.store.current)}}function rt(t){t.test&&console.log("call dom listeners",t._collector.domEvents);for(let e=0;e<t._collector.domEvents.length;e++){const n=t._collector.domEvents[e];n.el.addEventListener(n.evt,n.fn)}}function it(t){B(t,nt)}function ot(t){B(t,rt),B(t,st)}const at=new Set(["g","svg","defs"]);function E(t,e=document.body,n){let s=0;const r=Z(t,at.has(e.tagName));let i={_collector:r};if(it(i),B(i,function(o){o.afterRender&&o.afterRender(o.props)}),typeof e=="function"){const o=r.nodes.length<2?r.nodes[0]:r.nodes;e(o)}else if(e)for(s=0;s<r.nodes.length;s++)e.appendChild(r.nodes[s]);if((!n||n.mounted)&&(ot(i),B(i,function(o){o.mounted=!0,o.afterMount&&o.afterMount(o.props)})),n&&n._collector){const o=n._collector;for(s=0;s<r.components.length;s++)r.components[s]._parent=n;o.refs&&(o.refs=o.refs.concat(r.refs)),o.components&&(o.components=o.components.concat(r.components)),o.domEvents&&(o.domEvents=o.domEvents.concat(r.domEvents)),o.storeEvents&&(o.storeEvents=o.storeEvents.concat(r.storeEvents))}return i=void 0,r}class C{constructor(e={}){this._parent=null,this._collector={refs:[],components:[],domEvents:[],storeEvents:[]},this._storeListeners=[],this.refs={},this.state={},this.store={},this.props=e||{},this.base=null,this.mounted=!1,this.destroyed=!1;const n=e.name||this.constructor.name||"Component",{log:s,warn:r,error:i}=qe(n,"white","#000",e.disableLog);this.log=s,this.warn=r,this.error=i}storeSubscribe(e,n,s,r=!0){e.subscribe(n,s),this._storeListeners.push([e,n,s]),r&&n.call(s,e.current)}template(){}beforeRender(){}afterRender(){}afterMount(){}beforeDestroy(){}ref(e){const n=this;return function(r){n.refs[e]=r}}refArray(e,n=!1){const s=this.refs[e]||(this.refs[e]=[]);let r=s.length,i,o;return n&&(i=this.refs.__pools||(this.refs.__pools={}),o=i[e]||(i[e]=[]),o.length&&(r=o.pop())),s[r]=null,function(f){s[r]=f,n&&o.push(r)}}refMap(e,n){const s=this.refs[n]||(this.refs[n]=new Map);return function(i){i?s.set(e,i):s.delete(e)}}render(e,n){return E(e,n,this)}destroy(){let e=0;for(this.beforeDestroy(this.props),e=this._collector.domEvents.length-1;e>=0;e--){const s=this._collector.domEvents[e];s.el.removeEventListener(s.evt,s.fn)}for(e=this._collector.storeEvents.length-1;e>=0;e--){const s=this._collector.storeEvents[e];s.store.unsubscribe(s.fn)}for(e=this._storeListeners.length-1;e>=0;e--){const s=this._storeListeners[e];s[0].unsubscribe(s[1],s[2])}for(e=this._collector.components.length-1;e>=0;e--)this._collector.components[e].destroy();if(this.mounted=!1,this.destroyed=!0,this._parent){const s=this._parent._collector.components.indexOf(this);~s&&this._parent._collector.components.splice(s,1),this._parent=null}for(e=this._collector.refs.length-1;e>=0;e--)this._collector.refs[e].fn(null),this._collector.refs.splice(e,1);let n=Array.isArray(this.base)?this.base:[this.base];for(e=0;e<n.length;e++)n[e]&&n[e].parentNode&&n[e].parentNode.removeChild(n[e]);this.base=n=null,this.props=null,this.state=null,this.store=null,this.refs=null,this._storeListeners=null}}function _e(t,e,n,s){this.fn=e,this.ctx=n||null,this.owner=t,this.once=!!s}function se(t,e){e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),e.ctx=e.fn=e.owner=null,e===t._first&&(t._first=e.next),e===t._last&&(t._last=e.prev)}class lt{constructor(){this._first=this._last=null}dispatch(e,n,s,r,i){let o=this._first;for(;o;)o.fn.call(o.ctx,e,n,s,r,i),o.once&&this.unsubscribe(o),o=o.next}subscribe(e,n,s){const r=new _e(this,e,n,s);return this._first?(this._last.next=r,r.prev=this._last,this._last=r):(this._first=r,this._last=r),r}subscribeOnce(e,n){return this.subscribe(e,n,!0)}unsubscribe(e,n){if(e instanceof _e)return se(this,e);n||(n=null);let s=this._first;for(;s;)s.fn===e&&s.ctx===n&&se(this,s),s=s.next}unsubscribeAll(){let e=this._first;for(this._first=this._last=null;e;)se(this,e),e=e.next}}class Re extends lt{constructor(e){super(),this.current=e}set(){throw new Error("Cannot set a different value for a Readable Signal. Use Writable instead")}get(){return this.current}}function b(t){return new Re(t)}class Te extends Re{set(e,n){if(!n&&this.current===e)return;this.previous=this.current,this.current=e;let s=this._first;for(;s;)s.fn.call(s.ctx,this.current,this.previous),s.once&&this.unsubscribe(s),s=s.next}update(e,n){const s=e(this.current);this.set(s!==void 0?s:this.current,n)}}function g(t){return new Te(t)}function j(t,e){const n=new Te,s=n.set.bind(n);delete n.set;const r=Array.isArray(t);let i=r?new Array(t.length):null;if(r)for(let a=0,f=t.length;a<f;a++)i[a]=t[a].current,t[a].subscribe(function(u){i[a]=u,o()});else i=t.current,t.subscribe(function(a){i=a,o()});o();function o(){const a=e(i);a&&a.then?a.then(s):s(a)}return n}const xe=t=>j(t,e=>!e),ct=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M21 12C19.1114 14.991 15.7183 18 12 18C8.2817 18 4.88856 14.991 3 12C5.29855 9.15825 7.99163 6 12 6C16.0084 6 18.7015 9.1582 21 12Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,ft=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3 3L21 21" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M10.5 10.6771C10.1888 11.0296 10 11.4928 10 12C10 13.1045 10.8954 14 12 14C12.5072 14 12.9703 13.8112 13.3229 13.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M7.36185 7.5611C5.68002 8.73968 4.27894 10.4188 3 12C4.88856 14.991 8.2817 18 12 18C13.5499 18 15.0434 17.4772 16.3949 16.6508" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M12 6C16.0084 6 18.7015 9.1582 21 12C20.6815 12.5043 20.3203 13.0092 19.922 13.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,ut=`<svg width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M19.5 16L17.0248 12.6038" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M12 17.5V14" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M4.5 16L6.96895 12.6124" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M3 8C6.6 16 17.4 16 21 8" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,l={AA_AB_FILL_MODE_LENGTH:b(3),LINE_WIDTHS:b([{value:10,name:"medium"},{value:20,name:"large"},{value:5,name:"small"}]),COLORS:b([{value:"#FFF1E8"},{value:"#FF004D"},{value:"#FFA300"},{value:"#FFEC27"},{value:"#00E436"},{value:"#29ADFF"},{value:"#83769C"},{value:"#FF77A8"},{value:"#FFCCAA"}]),FILL_MODES:b([{value:"AA→AB"},{value:"AA→BB"},{value:"AA→AB→BB"},{value:"AB"}]),VIEW_MODES:b([{value:"wireframe",icon:ct},{value:"preview",icon:ft},{value:"no-ui",icon:ut}]),app:{drawMode:g("draw"),fillMode:g("AA→AB"),viewMode:g("wireframe"),lines:g([]),style:g({lineWidth:10,strokeStyle:"white",lineJoin:"round",lineCap:"round"})},raf:{fps:b(60),maxDuration:b(60*5),isRunning:g(!1),frameCount:g(0)},api:{url:b("https://toools-gcr-service-tnoires-ew9-prd-htddyedwxa-od.a.run.app"),pollingInterval:b(1e3),pollingMaxAttempts:b(30),version:g(null)}};window.Store=l;var dt=function(e,n){return e[0]=n[0],e[1]=n[1],e},Me=dt,ht=function(t,e){Array.isArray(e)||(e=[]),t.length>0&&e.push(Me([0,0],t[0]));for(var n=0;n<t.length-1;n++){var s=t[n],r=t[n+1],i=s[0],o=s[1],a=r[0],f=r[1],u=[.75*i+.25*a,.75*o+.25*f],d=[.25*i+.75*a,.25*o+.75*f];e.push(u),e.push(d)}return t.length>1&&e.push(Me([0,0],t[t.length-1])),e};class pe{constructor({points:e=[],fillMode:n="AA→AB",firstFrame:s=0,style:r={}}={}){this.points=e,this.fillMode=n,this.firstFrame=s,this.style=r}get isEmpty(){return!this.points||!this.points.length}push(e){this.points.push(e)}render(e,{frame:n=Number.POSITIVE_INFINITY,smoothed:s=!0,fillMode:r=this.fillMode,style:i=this.style,preferSprite:o=!0}={}){if(this.isEmpty||n<this.firstFrame&&r!=="AB")return;if(e.save(),r==="AB"&&o){this.sprite||(this.sprite=this.toSprite(e,{smoothed:s,fillMode:r,style:i})),e.drawImage(this.sprite,0,0),e.restore();return}e.beginPath();for(const[u,d]of Object.entries(i))u==="lineDash"&&e.setLineDash(d),e[u]=d;const a=[];switch(r){case"AB":a[0]=0,a[1]=this.points.length;break;case"AA→AB":a[0]=0,a[1]=n-this.firstFrame;break;case"AA→BB":a[0]=Math.max(0,n-this.firstFrame-l.AA_AB_FILL_MODE_LENGTH.get()),a[1]=n-this.firstFrame;break;case"AA→AB→BB":a[0]=Math.max(0,n-this.firstFrame-this.points.length/2),a[1]=n-this.firstFrame;break}const f=s?ht(this.points.slice(a[0],a[1])):this.points.slice(a[0],a[1]);for(let u=0;u<f.length;u++){const d=f[u];d&&e[u?"lineTo":"moveTo"](d[0],d[1])}e.stroke(),e.restore()}toSprite(e,n){const s=document.createElement("canvas");return s.width=e.canvas.width,s.height=e.canvas.height,this.render(s.getContext("2d"),{...n,preferSprite:!1}),s}toJSON(){return{points:this.points,fillMode:this.fillMode,firstFrame:this.firstFrame,style:this.style}}}function fe(t,e,n){var s,r,i,o,a;e==null&&(e=100);function f(){var d=Date.now()-o;d<e&&d>=0?s=setTimeout(f,e-d):(s=null,n||(a=t.apply(i,r),i=r=null))}var u=function(){i=this,r=arguments,o=Date.now();var d=n&&!s;return s||(s=setTimeout(f,e)),d&&(a=t.apply(i,r),i=r=null),a};return u.clear=function(){s&&(clearTimeout(s),s=null)},u.flush=function(){s&&(a=t.apply(i,r),i=r=null,clearTimeout(s),s=null)},u}fe.debounce=fe;var pt=fe;class Be extends C{beforeRender(e){this.handleResize=this.handleResize.bind(this),this.state={dpr:b(e.dpr||window.devicePixelRatio||1)}}template(){return c("canvas",{class:"canvas",ref:this.ref("canvas")})}afterMount(){this.context=this.refs.canvas.getContext("2d"),this.handleResize(),window.addEventListener("resize",pt(this.handleResize,100))}clear(){this.context.clearRect(0,0,this.refs.canvas.width,this.refs.canvas.height)}handleResize(){const e=this.state.dpr.get(),{width:n,height:s}=this.refs.canvas.getBoundingClientRect();this.refs.canvas.width=n*e,this.refs.canvas.height=s*e,this.context.scale(e,e)}}function gt(t,e){if(e===void 0)throw new Error("You must specify a callback");t===void 0&&(t=30);var n=1e3/t,s=0,r=0;return function(i){s-=i,r+=i,s<=0&&(e(r),r=0,s=n+s%n)}}var G=typeof window>"u"?global:window,P=[],F=[],S=[],O=null,R=null,$=!1,ge=!1,ve,A;function Y(t){t===void 0&&(t=0),R===null&&(R=t),A=t-R,ve+=A,R=t,O=$?null:G.requestAnimationFrame(Y),$&&($=!1);var e;if(ge){for(e=0;e<S.length;e++)S[e](A);for(e=0;e<P.length;e++)P[e](A);for(e=0;e<F.length;e++)F[e](A)}else for(e=0;e<P.length;e++)P[e](A)}function X(){ge=F.length>0||S.length>0}function we(t,e,n){return!e||!t||~t.indexOf(e)?!1:(n=!!n,n?t.unshift(e):t.push(e),!0)}function me(t,e){if(!e)return!1;var n=t.indexOf(e);return~n?(t.splice(n,1),t.length===0):!1}function vt(t,e){we(S,t,e)&&X()}function wt(t,e){we(F,t,e)&&X()}function mt(t,e){we(P,t,e)&&je()}function bt(t){me(S,t)&&X()}function yt(t,e){me(F,t)&&X()}function Ct(t){me(P,t)&&be()}function je(t){$=!1,!O&&(t=!!t,R=null,t?Y():O=G.requestAnimationFrame(Y))}function kt(){O||($=!0,R=null,O=G.requestAnimationFrame(Y))}function be(){O&&(G.cancelAnimationFrame(O),O=null)}function _t(){be(),P.length=0,F.length=0,S.length=0,ge=!1,R=null,ve=0,A=0}const Fe={add:mt,addAfter:wt,addBefore:vt,remove:Ct,removeAfter:yt,removeBefore:bt,start:je,stop:be,time:ve,dt:A,requestOnce:kt,dispose:_t},xt=()=>{l.raf.frameCount.update(t=>++t%l.raf.maxDuration.get())},Se=gt(l.raf.fps.current,xt);function Ke(){l.raf.isRunning.set(!0),Fe.add(Se)}function Ie(){l.raf.isRunning.set(!1),Fe.remove(Se)}function Mt(){l.raf.isRunning.update(t=>!t),l.raf.isRunning.get()?Ke():Ie()}const y={start:Ke,stop:Ie,toggle:Mt},ue=t=>{if(window.TouchEvent&&t instanceof TouchEvent){const e=t.targetTouches[0];return e?[e.clientX,e.clientY]:[-1,-1]}return[t.clientX,t.clientY]};let At=class extends C{beforeRender(e){this.update=this.update.bind(this),this.handleTick=this.handleTick.bind(this),this.handlePenDown=this.handlePenDown.bind(this),this.handlePenMove=this.handlePenMove.bind(this),this.handlePenUp=this.handlePenUp.bind(this),this.state={isDisabled:e["store-disabled"]||g(e.disabled),penDown:g(!1),penPosition:g([-1,-1]),line:g(null)}}template(e,n){return c("section",{class:"drawer","store-class-has-pen-down":n.penDown,"store-class-is-disabled":n.isDisabled,"event-touchstart":this.handlePenDown,"event-mousedown":this.handlePenDown,"event-touchend":this.handlePenUp,"event-mouseup":this.handlePenUp},c(Be,{ref:this.ref("canvas")}))}afterRender(){document.body.addEventListener("mouseleave",this.handlePenUp),document.body.addEventListener("touchmove",e=>window.requestAnimationFrame(()=>this.handlePenMove(e))),document.body.addEventListener("mousemove",e=>window.requestAnimationFrame(()=>this.handlePenMove(e))),this.state.line.subscribe(this.update),l.raf.frameCount.subscribe(this.handleTick)}update(){this.refs.canvas.clear();const e=this.state.line.get();e&&e.render(this.refs.canvas.context,{frame:l.raf.frameCount.get(),fillMode:"AB",preferSprite:!1})}handlePenDown(e){this.state.penDown.set(!0),this.state.penPosition.set(ue(e));const n=new pe({firstFrame:l.raf.frameCount.get(),fillMode:l.app.fillMode.get(),style:l.app.style.get()});this.state.line.set(n)}handlePenMove(e){this.state.penDown.get()&&(y.start(),this.state.penPosition.set(ue(e)))}handleTick(){if(!this.state.penDown.get())return;const e=this.state.line.get();if(e){if(e.firstFrame+e.points.length>=l.raf.maxDuration.get()){this.handlePenUp();return}this.state.line.update(n=>(n.push(this.state.penPosition.get()),n),!0)}}handlePenUp(e){this.state.penDown.set(!1);const n=this.state.line.get();this.state.line.set(null),!(!n||n.isEmpty)&&l.app.lines.update(s=>(s.push(n),s),!0)}};const Lt=t=>t[t.length-1];class Et extends C{beforeRender(e){this.handleClick=this.handleClick.bind(this),this.state={isDisabled:e["store-disabled"]||g(e.disabled)}}template(e,n){return c("section",{class:"paster","store-class-is-disabled":n.isDisabled,"event-click":this.handleClick})}handleClick(e){const n=Lt(l.app.lines.get());if(!n)return;const[s,r]=ue(e),i=n.points[0][0]-s,o=n.points[0][1]-r,a=new pe({points:n.points.map(([f,u])=>[f-i,u-o]),firstFrame:l.raf.frameCount.get(),style:Object.assign({},n.style,l.app.style.current),fillMode:l.app.fillMode.get()});y.start(),l.app.lines.update(f=>(f.push(a),f),!0)}}class Ot extends C{beforeRender(){this.handleTick=this.handleTick.bind(this)}template(e,n){return c("section",{class:"renderer"},c(Be,{ref:this.ref("canvas")}))}afterRender(){l.app.lines.subscribe(this.handleTick),l.app.viewMode.subscribe(this.handleTick),l.raf.frameCount.subscribe(this.handleTick)}handleTick(){this.refs.canvas.clear();const e=l.raf.frameCount.get(),n=l.app.viewMode.get(),{context:s}=this.refs.canvas;for(const r of l.app.lines.get())n==="wireframe"&&r.fillMode!=="AB"&&r.render(s,{fillMode:"AB",style:{lineWidth:2,strokeStyle:"rgba(255 255 255 / 50%)",lineDash:[10,10]}}),r.render(s,{frame:e,smoothed:!0})}}var V={},Dt={get exports(){return V},set exports(t){V=t}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var s=[],r=0;r<arguments.length;r++){var i=arguments[r];if(i){var o=typeof i;if(o==="string"||o==="number")s.push(i);else if(Array.isArray(i)){if(i.length){var a=n.apply(null,i);a&&s.push(a)}}else if(o==="object"){if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]")){s.push(i.toString());continue}for(var f in i)e.call(i,f)&&i[f]&&s.push(f)}}}return s.join(" ")}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(Dt);class k extends C{beforeRender(e){this.animate=this.animate.bind(this),this.handleClick=this.handleClick.bind(this),this.state={label:e["store-label"]||b(e.label),isWaiting:e["store-is-waiting"]||g(!1),isDisabled:e["store-disabled"]||g(e.disabled),isHidden:e["store-hidden"]||g(e.hidden)}}template(e,n){return c("button",{class:V("button",e.class),"store-class-is-waiting":n.isWaiting,"store-disabled":n.isDisabled,"store-hidden":n.isHidden,"event-click":this.handleClick,"event-mouseenter":e["event-mouseenter"]||L,"event-mouseleave":e["event-mouseleave"]||L,title:e.title,style:e.style,type:e.type},e.icon&&c("div",{class:"button__icon",ref:this.ref("icon"),innerHTML:e.icon}),c("div",{class:"button__text","store-innerHTML":n.label}))}afterRender(){this.state.isHidden.subscribe(this.animate)}animate(){this&&this.refs&&this.refs.icon&&(this.refs.icon.style.animation="none",this.refs.icon.offsetHeight,this.refs.icon.style.animation=null)}async handleClick(e){if(this.state.isWaiting.get())return e.preventDefault();this.animate(),this.state.isWaiting.set(!0),await(this.props["event-click"]||L)(e),this.mounted&&this.state.isWaiting.set(!1)}}let Pt=t=>crypto.getRandomValues(new Uint8Array(t)),Rt=(t,e,n)=>{let s=(2<<Math.log(t.length-1)/Math.LN2)-1,r=-~(1.6*s*e/t.length);return(i=e)=>{let o="";for(;;){let a=n(r),f=r;for(;f--;)if(o+=t[a[f]&s]||"",o.length===i)return o}}},Tt=(t,e=21)=>Rt(t,e,Pt);const de=t=>l.api.url.get()+"/api/"+t,Bt={timer:null,attempts:0,start:function(){if(this.stop(),!(!l.api||!l.api.url.get())){if(this.attempts>=l.api.pollingMaxAttempts.get()){console.warn("api max polling attempts reached"),l.api=null,console.error("Impossible de contacter l’API: l’export PDF ne sera pas disponible.");return}this.timer=setTimeout(async()=>{this.attempts++;try{const e=await(await fetch(de("version"),{method:"GET"})).json();if(!e||!e.version)throw new Error("Ping malformed");l.api.version.set(e.version)}catch{this.start()}},l.api.pollingInterval.get())}},stop:function(){clearTimeout(this.timer)}},ye={polling:Bt,import:async t=>{const e=await fetch(de("json/"+t));if(!e.ok&&e.status!==500)throw e;const n=e.json();if(n.error)throw new Error(n.error);return n},export:async(t,e)=>{const n=await fetch(de(e?"json?uid="+e:"json"),{method:"PUT",body:JSON.stringify(t)});if(!n.ok&&n.status!==500)throw n;const s=n.json();if(s.error)throw new Error(s.error);return s}};const Ne=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;let Q=class extends C{beforeRender(){this.destroy=this.destroy.bind(this)}template(e){return c("div",{class:"modal__wrapper",...e.bigText&&{"event-click":this.destroy}},c("section",{class:V("modal",e.class,{"big-text":e.bigText})},c("header",{class:"modal__header"},c("h2",{class:"modal__title"},e.title),c(k,{icon:Ne,"event-click":this.destroy})),c("div",{class:"modal__content"},e.children)))}beforeDstroy(){this.destroyed||(this.props["event-close"]||L)()}};const jt=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5 13L9 17L19 7" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;function Ft(t,e){E(c(Q,{...e,bigText:!0},e.url?c("a",{href:e.url},t):t))}function St(t,e){E(c(Q,{...e},t))}function Kt(t,{title:e="Action requise",yes:n="Valider",no:s="Annuler",onYes:r=()=>!0,onNo:i=()=>!1,onCancel:o=()=>null}={}){return new Promise(a=>{let f;E(c(Q,{ref:w=>{f=w},"event-close":async()=>a(await o(this))},t,c("footer",null,c("fieldset",{class:"group"},c(k,{"event-click":async()=>{a(await i(this)),f.destroy()},icon:Ne,label:s}),c(k,{"event-click":async()=>{a(await r(this)),f.destroy()},icon:jt,label:n})))))})}function It(t){const e=t instanceof Response?"api":t instanceof Error?"internal":"unknown";E(c(Q,{title:e==="api"?"Erreur de l’API":"Erreur"},e==="internal"&&[c("p",null,t.message),c("pre",{class:"stacktrace"},t.stack)],e==="api"&&[c("p",null,"[",t.status,"] ",t.statusText),c("pre",{class:"stacktrace"},t.message)],e==="unknown"&&[c("p",null,"Une erreur inconnue est survenue")]))}const U={bigText:Ft,say:St,confirm:Kt,error:It},Nt=Tt("0123456789ABCDEF",6);async function Ht({force:t=!1}={}){!t&&!await U.confirm("Tout effacer ?")||(l.app.lines.set([]),l.app.drawMode.set("draw"))}function $t(){l.app.lines.update(t=>t.slice(0,t.length-1),!0),l.app.lines.current.length||l.app.drawMode.set("draw")}async function Vt(){const t=l.app.lines.current.map(e=>e.toJSON());try{const{uid:e}=await ye.export(t,Nt());U.bigText(e,{url:window.location.origin+(window.location.path||"/")+"?uid="+e})}catch(e){U.error(e)}}async function Ut(t){l.api.version.get()||await new Promise(e=>l.api.version.subscribeOnce(e));try{const e=await ye.import(t);l.app.lines.set(e.map(n=>new pe(n))),y.start()}catch(e){e.status&&e.status===404?U.say("Impossible de trouver l’animation demandée",{title:"Erreur"}):U.error(e)}}const K={clear:Ht,undo:$t,save:Vt,load:Ut},Wt=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3 19V5C3 3.89543 3.89543 3 5 3H16.1716C16.702 3 17.2107 3.21071 17.5858 3.58579L20.4142 6.41421C20.7893 6.78929 21 7.29799 21 7.82843V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19Z" stroke="currentColor" stroke-width="1.5"/>
<path d="M8.6 9H15.4C15.7314 9 16 8.73137 16 8.4V3.6C16 3.26863 15.7314 3 15.4 3H8.6C8.26863 3 8 3.26863 8 3.6V8.4C8 8.73137 8.26863 9 8.6 9Z" stroke="currentColor" stroke-width="1.5"/>
<path d="M6 13.6V21H18V13.6C18 13.2686 17.7314 13 17.4 13H6.6C6.26863 13 6 13.2686 6 13.6Z" stroke="currentColor" stroke-width="1.5"/>
</svg>
`,qt=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6.90588 4.53682C6.50592 4.2998 6 4.58808 6 5.05299V18.947C6 19.4119 6.50592 19.7002 6.90588 19.4632L18.629 12.5162C19.0211 12.2838 19.0211 11.7162 18.629 11.4838L6.90588 4.53682Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,Zt=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6 18.4V5.6C6 5.26863 6.26863 5 6.6 5H9.4C9.73137 5 10 5.26863 10 5.6V18.4C10 18.7314 9.73137 19 9.4 19H6.6C6.26863 19 6 18.7314 6 18.4Z" stroke="currentColor" stroke-width="1.5"/>
<path d="M14 18.4V5.6C14 5.26863 14.2686 5 14.6 5H17.4C17.7314 5 18 5.26863 18 5.6V18.4C18 18.7314 17.7314 19 17.4 19H14.6C14.2686 19 14 18.7314 14 18.4Z" stroke="currentColor" stroke-width="1.5"/>
</svg>
`;class zt extends C{beforeRender(){this.update=this.update.bind(this),this.handleChange=this.handleChange.bind(this)}template(e,n){return c("section",{class:"timeline"},c("fieldset",{class:"group"},c(k,{icon:Zt,"store-hidden":xe(l.raf.isRunning),"event-click":y.stop}),c(k,{icon:qt,"store-hidden":l.raf.isRunning,"event-click":y.start}),c("input",{type:"range",ref:this.ref("input"),"event-input":this.handleChange,step:"1","store-value":l.raf.frameCount,"store-max":l.raf.maxDuration})),c(k,{icon:Wt,"event-click":K.save,"store-hidden":xe(l.api.version),"store-disabled":j(l.app.lines,s=>!s.length)}))}afterRender(){l.raf.frameCount.subscribe(this.update)}update(){const e=l.raf.frameCount.get();this.refs.input.value=e}handleChange(e){y.stop(),l.raf.frameCount.set(+e.target.value)}}class H extends C{beforeRender(e){this.update=this.update.bind(this),this.state={value:e["store-value"]||g(((e.values||[])[0]||{}).value)}}template(e,n){return c("div",{class:V("switcher",e.class)},e.values.map((s,r)=>c(k,{...s,ref:this.refArray("buttons"),"event-click":()=>this.handleChange(this.props.values[(r+1)%this.props.values.length])})))}afterMount(){this.state.value.subscribe(this.update),this.update()}update(){const e=this.props.values.findIndex(({value:n})=>n===this.state.value.current);for(let n=0;n<this.refs.buttons.length;n++)this.refs.buttons[n].state.isHidden.set(n!==e)}handleChange(e){(this.props["event-change"]||L)(e.value),this.state.value.set(e.value)}}const Ae=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,Jt=`<svg width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M20 9L18.005 20.3463C17.8369 21.3026 17.0062 22 16.0353 22H7.96474C6.99379 22 6.1631 21.3026 5.99496 20.3463L4 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M21 6L15.375 6M3 6L8.625 6M8.625 6V4C8.625 2.89543 9.52043 2 10.625 2H13.375C14.4796 2 15.375 2.89543 15.375 4V6M8.625 6L15.375 6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,Yt=`<svg width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.3632 5.65156L15.8431 4.17157C16.6242 3.39052 17.8905 3.39052 18.6716 4.17157L20.0858 5.58579C20.8668 6.36683 20.8668 7.63316 20.0858 8.41421L18.6058 9.8942M14.3632 5.65156L4.74749 15.2672C4.41542 15.5993 4.21079 16.0376 4.16947 16.5054L3.92738 19.2459C3.87261 19.8659 4.39148 20.3848 5.0115 20.33L7.75191 20.0879C8.21972 20.0466 8.65806 19.8419 8.99013 19.5099L18.6058 9.8942M14.3632 5.65156L18.6058 9.8942" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,Gt=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M13.8476 13.317L9.50515 18.2798C8.70833 19.1905 7.29167 19.1905 6.49485 18.2798L2.15238 13.317C1.49259 12.563 1.49259 11.437 2.15238 10.683L6.49485 5.72018C7.29167 4.80952 8.70833 4.80952 9.50515 5.72017L13.8476 10.683C14.5074 11.437 14.5074 12.563 13.8476 13.317Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M13 19L17.8844 13.3016C18.5263 12.5526 18.5263 11.4474 17.8844 10.6984L13 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M17 19L21.8844 13.3016C22.5263 12.5526 22.5263 11.4474 21.8844 10.6984L17 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,Xt=`<svg width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4.5 8C8.5 8 11 8 15 8C15 8 15 8 15 8C15 8 20 8 20 12.7059C20 18 15 18 15 18C11.5714 18 9.71429 18 6.28571 18" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M7.5 11.5C6.13317 10.1332 5.36683 9.36683 4 8C5.36683 6.63317 6.13317 5.86683 7.5 4.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`,Qt=`<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M9 2L15 2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M12 10L12 14" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M12 22C16.4183 22 20 18.4183 20 14C20 9.58172 16.4183 6 12 6C7.58172 6 4 9.58172 4 14C4 18.4183 7.58172 22 12 22Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;class en extends C{beforeRender(){this.state={hasNoLines:j(l.app.lines,e=>!e.length)}}template(e,n){return c("section",{class:"toolbar"},c("fieldset",null,c(H,{"store-value":l.app.drawMode,values:[{icon:Yt,label:"Dessin",value:"draw","store-disabled":n.hasNoLines},{icon:Gt,label:"Tampon",value:"paste"}]}),c("fieldset",{class:"group"},c(H,{values:l.LINE_WIDTHS.get().map(({name:s,value:r})=>({value:r,icon:Ae,class:`disc disc-${s}`})),"event-change":s=>{l.app.style.update(r=>({...r,lineWidth:s}),!0)}}),c(H,{values:l.COLORS.get().map(({label:s,value:r})=>({value:r,icon:Ae,class:"disc",style:`--color: ${r}`})),"event-change":s=>{l.app.style.update(r=>({...r,strokeStyle:s}),!0)}})),c(H,{values:l.FILL_MODES.get().map(({value:s})=>({value:s,icon:Qt,label:s.replace(/(→)/g,"&thinsp;$1&thinsp;")})),"event-change":s=>l.app.fillMode.set(s)})),c("fieldset",null,c(H,{class:"view-mode",values:l.VIEW_MODES.get(),"store-value":l.app.viewMode}),c("fieldset",{class:"group"},c(k,{icon:Xt,"store-disabled":n.hasNoLines,"event-click":K.undo}),c(k,{icon:Jt,"store-disabled":j(l.app.lines,s=>!s.length),"event-click":K.clear}))))}}class tn extends C{template(e){return c("main",{class:"app","store-data-view-mode":l.app.viewMode},c(en,null),c("div",{class:"app__main"},c(At,{"store-disabled":j(l.app.drawMode,n=>n!=="draw")}),c(Et,{"store-disabled":j(l.app.drawMode,n=>n!=="paste")}),c(Ot,null)),c(zt,null))}}const nn=`<svg width='100%' height='100%' viewBox='0 0 116 100'>
  <path d='M57.734,82.319C39.884,82.319 25.414,67.85 25.414,50C25.414,32.15 39.884,17.681 57.734,17.681C75.584,17.681 90.053,32.15 90.053,50C90.053,67.85 75.584,82.319 57.734,82.319M86.603,-0L28.867,-0L0,50L28.867,100L86.603,100L115.47,50L86.603,-0Z' />
</svg>
`;class Le extends C{beforeRender(e){this.handleClick=this.handleClick.bind(this),this.state={isClickable:b(e.clickable!==!1)}}template(e,n){return c("section",{class:"splashscreen","store-class-is-clickable":n.isClickable,"event-click":this.handleClick},c("div",{class:"splashscreen__content"},c("div",{class:"splashscreen__icon",innerHTML:nn}),c(k,{label:e.text||"Nouveau dessin"})))}async handleClick(){this.state.isClickable.get()&&(document.body.requestFullscreen&&await document.body.requestFullscreen(),this.destroy())}}var re=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function ie(t,e,n,s){t.addEventListener?t.addEventListener(e,n,s):t.attachEvent&&t.attachEvent("on".concat(e),function(){n(window.event)})}function He(t,e){for(var n=e.slice(0,e.length-1),s=0;s<n.length;s++)n[s]=t[n[s].toLowerCase()];return n}function $e(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");for(var e=t.split(","),n=e.lastIndexOf("");n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function sn(t,e){for(var n=t.length>=e.length?t:e,s=t.length>=e.length?e:t,r=!0,i=0;i<n.length;i++)s.indexOf(n[i])===-1&&(r=!1);return r}var W={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":re?173:189,"=":re?61:187,";":re?59:186,"'":222,"[":219,"]":221,"\\":220},_={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},he={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},v={16:!1,18:!1,17:!1,91:!1},p={};for(var J=1;J<20;J++)W["f".concat(J)]=111+J;var h=[],Ee=!1,Ve="all",Ue=[],ee=function(e){return W[e.toLowerCase()]||_[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)},rn=function(e){return Object.keys(W).find(function(n){return W[n]===e})},on=function(e){return Object.keys(_).find(function(n){return _[n]===e})};function We(t){Ve=t||"all"}function q(){return Ve||"all"}function an(){return h.slice(0)}function ln(){return h.map(function(t){return rn(t)||on(t)||String.fromCharCode(t)})}function cn(t){var e=t.target||t.srcElement,n=e.tagName,s=!0;return(e.isContentEditable||(n==="INPUT"||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(s=!1),s}function fn(t){return typeof t=="string"&&(t=ee(t)),h.indexOf(t)!==-1}function un(t,e){var n,s;t||(t=q());for(var r in p)if(Object.prototype.hasOwnProperty.call(p,r))for(n=p[r],s=0;s<n.length;)n[s].scope===t?n.splice(s,1):s++;q()===t&&We(e||"all")}function dn(t){var e=t.keyCode||t.which||t.charCode,n=h.indexOf(e);if(n>=0&&h.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&h.splice(0,h.length),(e===93||e===224)&&(e=91),e in v){v[e]=!1;for(var s in _)_[s]===e&&(M[s]=!1)}}function hn(t){if(typeof t>"u")Object.keys(p).forEach(function(o){return delete p[o]});else if(Array.isArray(t))t.forEach(function(o){o.key&&oe(o)});else if(typeof t=="object")t.key&&oe(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];var r=n[0],i=n[1];typeof r=="function"&&(i=r,r=""),oe({key:t,scope:r,method:i,splitKey:"+"})}}var oe=function(e){var n=e.key,s=e.scope,r=e.method,i=e.splitKey,o=i===void 0?"+":i,a=$e(n);a.forEach(function(f){var u=f.split(o),d=u.length,w=u[d-1],m=w==="*"?"*":ee(w);if(p[m]){s||(s=q());var N=d>1?He(_,u):[];p[m]=p[m].filter(function(x){var D=r?x.method===r:!0;return!(D&&x.scope===s&&sn(x.mods,N))})}})};function Oe(t,e,n,s){if(e.element===s){var r;if(e.scope===n||e.scope==="all"){r=e.mods.length>0;for(var i in v)Object.prototype.hasOwnProperty.call(v,i)&&(!v[i]&&e.mods.indexOf(+i)>-1||v[i]&&e.mods.indexOf(+i)===-1)&&(r=!1);(e.mods.length===0&&!v[16]&&!v[18]&&!v[17]&&!v[91]||r||e.shortcut==="*")&&e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}}function De(t,e){var n=p["*"],s=t.keyCode||t.which||t.charCode;if(M.filter.call(this,t)){if((s===93||s===224)&&(s=91),h.indexOf(s)===-1&&s!==229&&h.push(s),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(x){var D=he[x];t[x]&&h.indexOf(D)===-1?h.push(D):!t[x]&&h.indexOf(D)>-1?h.splice(h.indexOf(D),1):x==="metaKey"&&t[x]&&h.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(h=h.slice(h.indexOf(D))))}),s in v){v[s]=!0;for(var r in _)_[r]===s&&(M[r]=!0);if(!n)return}for(var i in v)Object.prototype.hasOwnProperty.call(v,i)&&(v[i]=t[he[i]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(h.indexOf(17)===-1&&h.push(17),h.indexOf(18)===-1&&h.push(18),v[17]=!0,v[18]=!0);var o=q();if(n)for(var a=0;a<n.length;a++)n[a].scope===o&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&Oe(t,n[a],o,e);if(s in p){for(var f=0;f<p[s].length;f++)if((t.type==="keydown"&&p[s][f].keydown||t.type==="keyup"&&p[s][f].keyup)&&p[s][f].key){for(var u=p[s][f],d=u.splitKey,w=u.key.split(d),m=[],N=0;N<w.length;N++)m.push(ee(w[N]));m.sort().join("")===h.sort().join("")&&Oe(t,u,o,e)}}}}function pn(t){return Ue.indexOf(t)>-1}function M(t,e,n){h=[];var s=$e(t),r=[],i="all",o=document,a=0,f=!1,u=!0,d="+",w=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(i=e.scope),e.element&&(o=e.element),e.keyup&&(f=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(w=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey)),typeof e=="string"&&(i=e);a<s.length;a++)t=s[a].split(d),r=[],t.length>1&&(r=He(_,t)),t=t[t.length-1],t=t==="*"?"*":ee(t),t in p||(p[t]=[]),p[t].push({keyup:f,keydown:u,scope:i,mods:r,shortcut:s[a],method:n,key:s[a],splitKey:d,element:o});typeof o<"u"&&!pn(o)&&window&&(Ue.push(o),ie(o,"keydown",function(m){De(m,o)},w),Ee||(Ee=!0,ie(window,"focus",function(){h=[]},w)),ie(o,"keyup",function(m){De(m,o),dn(m)},w))}function gn(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(p).forEach(function(n){var s=p[n].filter(function(r){return r.scope===e&&r.shortcut===t});s.forEach(function(r){r&&r.method&&r.method()})})}var ae={getPressedKeyString:ln,setScope:We,getScope:q,deleteScope:un,getPressedKeyCodes:an,isPressed:fn,filter:cn,trigger:gn,unbind:hn,keyMap:W,modifier:_,modifierMap:he};for(var le in ae)Object.prototype.hasOwnProperty.call(ae,le)&&(M[le]=ae[le]);if(typeof window<"u"){var vn=window.hotkeys;M.noConflict=function(t){return t&&window.hotkeys===M&&(window.hotkeys=vn),M},window.hotkeys=M}[{key:"space",description:"Jouer ou stopper l’animation",callback:y.toggle},{key:"left",description:"Reculer d’une image",callback:()=>{y.stop(),l.raf.frameCount.update(t=>Math.max(0,t-1))}},{key:"shift+left",description:"Reculer de 10 images",callback:()=>{y.stop(),l.raf.frameCount.update(t=>Math.max(0,t-10))}},{key:"right",description:"Avancer d’une image",callback:()=>{y.stop(),l.raf.frameCount.update(t=>Math.min(t+1,l.raf.maxDuration.get()))}},{key:"shift+right",description:"Avancer de 10 images",callback:()=>{y.stop(),l.raf.frameCount.update(t=>Math.min(t+10,l.raf.maxDuration.get()))}},{key:"cmd+z",description:"Effacer le dernier dessin",callback:K.undo},{key:"cmd+x",description:"Tout effacer",callback:K.clear},{key:"w",description:"Afficher/masquer les dessins à venir",callback:()=>l.app.viewMode.update(t=>t==="wireframe"?"preview":"wireframe")},{key:"tab",description:"Afficher / cacher l’interface",callback:t=>{t.preventDefault(),l.app.viewMode.update(e=>e==="no-ui"?"wireframe":"no-ui")}}].map(wn);function wn(t){return t.callback&&!t.disabled&&M(t.key,e=>{t.filter&&t.filter(e)||(e.preventDefault(),e.stopPropagation(),t.callback(e))}),t}console.log("1.0.2-production");const Pe=new URLSearchParams(window.location.search).get("uid");(async()=>{if(ye.polling.start(),Pe){const{components:t}=E(c(Le,{text:"Chargement…",clickable:!1}));await K.load(Pe),t[0].destroy()}else E(c(Le,null));E(c(tn,null))})();
